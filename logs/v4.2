[0;0m# salt minion cmd.run 'rm -f /etc/dhcp/dhclient-enter-hooks'
[0;36mminion[0;0m:
[0;0m# salt minion cmd.run 'dhclient -r && dhclient'
[0;36mminion[0;0m:
[0;0m# salt minion state.sls name_resolution
[0;32mminion:[0;0m
[0;36m----------[0;0m
    [0;36m      ID: /etc/resolv.conf[0;0m
    [0;36mFunction: file.managed[0;0m
    [0;36m  Result: True[0;0m
    [0;36m Comment: File /etc/resolv.conf updated[0;0m
    [0;36m Started: 16:09:58.977401[0;0m
    [0;36mDuration: 110.336 ms[0;0m
[0;36m     Changes:   
              [0;36m----------[0;0m
              [0;36mdiff[0;0m:
                  [0;32m---  [0;0m
                  [0;32m+++  [0;0m
                  [0;32m@@ -1,3 +1,3 @@[0;0m
                  [0;32m-; generated by /sbin/dhclient-script[0;0m
                  [0;32m-search ec2.internal[0;0m
                  [0;32m-nameserver 172.31.0.2[0;0m
                  [0;32m+; Managed by Salt, please do NOT edit[0;0m
                  [0;32m+search auto.dot[0;0m
                  [0;32m+nameserver 172.31.32.50[0;0m[0;0m
[0;36m----------[0;0m
    [0;36m      ID: sync_modules[0;0m
    [0;36mFunction: module.wait[0;0m
    [0;36m    Name: saltutil.sync_modules[0;0m
    [0;36m  Result: True[0;0m
    [0;36m Comment: Module function saltutil.sync_modules executed[0;0m
    [0;36m Started: 16:09:59.089639[0;0m
    [0;36mDuration: 180.131 ms[0;0m
[0;36m     Changes:   
              [0;36m----------[0;0m
              [0;36mret[0;0m:[0;0m
[0;36m----------[0;0m
    [0;36m      ID: reload_resolv_conf[0;0m
    [0;36mFunction: module.wait[0;0m
    [0;36m    Name: helper.reload_resolv_conf[0;0m
    [0;36m  Result: True[0;0m
    [0;36m Comment: Module function helper.reload_resolv_conf executed[0;0m
    [0;36m Started: 16:09:59.270943[0;0m
    [0;36mDuration: 1.127 ms[0;0m
[0;36m     Changes:   
              [0;36m----------[0;0m
              [0;36mret[0;0m:
                  [0;1;33mNone[0;0m[0;0m
[0;36m----------[0;0m
    [0;36m      ID: schedule_salt-minion_restart[0;0m
    [0;36mFunction: cmd.wait[0;0m
    [0;36m    Name: nohup /bin/sh -c 'sleep 3; salt-call --local service.stop salt-minion; sleep 3; killall salt-minion; sleep 3; salt-call --local service.restart salt-minion; sleep 3; salt-call --local service.start salt-minion' >>/var/log/salt/minion 2>&1 & echo Salt-Minion Restart Scheduled ...[0;0m
    [0;36m  Result: True[0;0m
    [0;36m Comment: Command "nohup /bin/sh -c 'sleep 3; salt-call --local service.stop salt-minion; sleep 3; killall salt-minion; sleep 3; salt-call --local service.restart salt-minion; sleep 3; salt-call --local service.start salt-minion' >>/var/log/salt/minion 2>&1 & echo Salt-Minion Restart Scheduled ..." run[0;0m
    [0;36m Started: 16:09:59.274179[0;0m
    [0;36mDuration: 13.504 ms[0;0m
[0;36m     Changes:   
              [0;36m----------[0;0m
              [0;36mpid[0;0m:
                  [0;1;33m4115[0;0m
              [0;36mretcode[0;0m:
                  [0;1;33m0[0;0m
              [0;36mstderr[0;0m:
              [0;36mstdout[0;0m:
                  [0;32mSalt-Minion Restart Scheduled ...[0;0m[0;0m
[0;32m----------[0;0m
    [0;32m      ID: /tmp/test[0;0m
    [0;32mFunction: file.managed[0;0m
    [0;32m  Result: True[0;0m
    [0;32m Comment: File /tmp/test is in the correct state[0;0m
    [0;32m Started: 16:09:59.287922[0;0m
    [0;32mDuration: 1.108 ms[0;0m
[0;32m     Changes:   [0;0m
[0;36m
Summary for minion
------------[0;0m
[0;32mSucceeded: 5[0;0m ([0;32mchanged=4[0;0m)
[0;36mFailed:    0[0;0m
[0;36m------------
Total states run:     5[0;0m
[0;0m# 
[0;0m# 
[0;0m# 
[0;0m# salt minion state.sls dns
[0;32mminion:[0;0m
[0;36m----------[0;0m
    [0;36m      ID: /etc/dhcp/dhclient-enter-hooks[0;0m
    [0;36mFunction: file.managed[0;0m
    [0;36m  Result: True[0;0m
    [0;36m Comment: File /etc/dhcp/dhclient-enter-hooks updated[0;0m
    [0;36m Started: 16:10:22.485585[0;0m
    [0;36mDuration: 117.195 ms[0;0m
[0;36m     Changes:   
              [0;36m----------[0;0m
              [0;36mdiff[0;0m:
                  [0;32mNew file[0;0m
              [0;36mmode[0;0m:
                  [0;32m0755[0;0m[0;0m
[0;36m----------[0;0m
    [0;36m      ID: renew_dhcp[0;0m
    [0;36mFunction: cmd.wait[0;0m
    [0;36m    Name: dhclient -r && dhclient[0;0m
    [0;36m  Result: True[0;0m
    [0;36m Comment: Command "dhclient -r && dhclient" run[0;0m
    [0;36m Started: 16:10:22.605324[0;0m
    [0;36mDuration: 2644.536 ms[0;0m
[0;36m     Changes:   
              [0;36m----------[0;0m
              [0;36mpid[0;0m:
                  [0;1;33m4403[0;0m
              [0;36mretcode[0;0m:
                  [0;1;33m0[0;0m
              [0;36mstderr[0;0m:
              [0;36mstdout[0;0m:[0;0m
[0;32m----------[0;0m
    [0;32m      ID: named[0;0m
    [0;32mFunction: pkg.installed[0;0m
    [0;32m    Name: bind[0;0m
    [0;32m  Result: True[0;0m
    [0;32m Comment: Package bind is already installed[0;0m
    [0;32m Started: 16:10:25.691373[0;0m
    [0;32mDuration: 373.892 ms[0;0m
[0;32m     Changes:   [0;0m
[0;36m----------[0;0m
    [0;36m      ID: /etc/named.conf[0;0m
    [0;36mFunction: file.managed[0;0m
    [0;36m  Result: True[0;0m
    [0;36m Comment: File /etc/named.conf updated[0;0m
    [0;36m Started: 16:10:26.067309[0;0m
    [0;36mDuration: 122.47 ms[0;0m
[0;36m     Changes:   
              [0;36m----------[0;0m
              [0;36mdiff[0;0m:
                  [0;32m---  [0;0m
                  [0;32m+++  [0;0m
                  [0;32m@@ -10,6 +10,9 @@[0;0m
                  [0;32m         memstatistics-file "/var/named/data/named_mem_stats.txt";[0;0m
                  [0;32m 	allow-query     { any; };[0;0m
                  [0;32m 	recursion yes;[0;0m
                  [0;32m+[0;0m
                  [0;32m+	include "/etc/named.forwarders";[0;0m
                  [0;32m+	forward first;[0;0m
                  [0;32m };[0;0m
                  [0;32m [0;0m
                  [0;32m logging {[0;0m
                  [0;32m@@ -19,14 +22,14 @@[0;0m
                  [0;32m         };[0;0m
                  [0;32m };[0;0m
                  [0;32m [0;0m
                  [0;32m-zone "." IN {[0;0m
                  [0;32m-	type hint;[0;0m
                  [0;32m-	file "named.ca";[0;0m
                  [0;32m-};[0;0m
                  [0;32m+# This is done by forwarding[0;0m
                  [0;32m+# zone "." IN {[0;0m
                  [0;32m+#	type hint;[0;0m
                  [0;32m+#	file "named.ca";[0;0m
                  [0;32m+# };[0;0m
                  [0;32m+# include "/etc/named.root.key";[0;0m
                  [0;32m [0;0m
                  [0;32m include "/etc/named.rfc1912.zones";[0;0m
                  [0;32m-include "/etc/named.root.key";[0;0m
                  [0;32m [0;0m
                  [0;32m [0;0m
                  [0;32m zone "auto.dot." IN {[0;0m[0;0m
[0;32m----------[0;0m
    [0;32m      ID: set_dns_sequence_grain[0;0m
    [0;32mFunction: module.run[0;0m
    [0;32m    Name: grains.setval[0;0m
    [0;32m  Result: True[0;0m
    [0;32m Comment: No changes detected[0;0m
    [0;32m Started: [0;0m
    [0;32mDuration: [0;0m
[0;32m     Changes:   [0;0m
[0;32m----------[0;0m
    [0;32m      ID: /var/named/named.auto.dot[0;0m
    [0;32mFunction: file.managed[0;0m
    [0;32m  Result: True[0;0m
    [0;32m Comment: File /var/named/named.auto.dot is in the correct state[0;0m
    [0;32m Started: 16:10:26.218544[0;0m
    [0;32mDuration: 24.308 ms[0;0m
[0;32m     Changes:   [0;0m
[0;36m----------[0;0m
    [0;36m      ID: named[0;0m
    [0;36mFunction: service.running[0;0m
    [0;36m  Result: True[0;0m
    [0;36m Comment: Service restarted[0;0m
    [0;36m Started: 16:10:26.305928[0;0m
    [0;36mDuration: 104.866 ms[0;0m
[0;36m     Changes:   
              [0;36m----------[0;0m
              [0;36mnamed[0;0m:
                  [0;1;33mTrue[0;0m[0;0m
[0;36m
Summary for minion
------------[0;0m
[0;32mSucceeded: 7[0;0m ([0;32mchanged=4[0;0m)
[0;36mFailed:    0[0;0m
[0;36m------------
Total states run:     7[0;0m
[0;0m# salt minion cmd.run 'nslookup ip-172-31-32-50.ec2.internal'
[0;36mminion[0;0m:
    [0;32mServer:		172.31.0.2[0;0m
    [0;32mAddress:	172.31.0.2#53[0;0m
    [0;32m[0;0m
    [0;32mNon-authoritative answer:[0;0m
    [0;32mName:	ip-172-31-32-50.ec2.internal[0;0m
    [0;32mAddress: 172.31.32.50[0;0m
[0;0m# salt minion cmd.run 'nslookup api.auto.dot'
[0;36mminion[0;0m:
    [0;32mServer:		172.31.0.2[0;0m
    [0;32mAddress:	172.31.0.2#53[0;0m
    [0;32m[0;0m
    [0;32m** server can't find api.auto.dot: NXDOMAIN[0;0m
ERROR: Minions returned with non-zero exit code
[0;0m# salt minion cmd.run 'cat /etc/resolv.conf'
[0;36mminion[0;0m:
    [0;32m; generated by /sbin/dhclient-script[0;0m
    [0;32msearch ec2.internal[0;0m
    [0;32mnameserver 172.31.0.2[0;0m
[0;0m# 
[0;0m# 
[0;0m# 
[0;0m# salt minion state.sls name_resolution
[0;32mminion:[0;0m
[0;36m----------[0;0m
    [0;36m      ID: /etc/resolv.conf[0;0m
    [0;36mFunction: file.managed[0;0m
    [0;36m  Result: True[0;0m
    [0;36m Comment: File /etc/resolv.conf updated[0;0m
    [0;36m Started: 16:11:36.936384[0;0m
    [0;36mDuration: 112.723 ms[0;0m
[0;36m     Changes:   
              [0;36m----------[0;0m
              [0;36mdiff[0;0m:
                  [0;32m---  [0;0m
                  [0;32m+++  [0;0m
                  [0;32m@@ -1,3 +1,3 @@[0;0m
                  [0;32m-; generated by /sbin/dhclient-script[0;0m
                  [0;32m-search ec2.internal[0;0m
                  [0;32m-nameserver 172.31.0.2[0;0m
                  [0;32m+; Managed by Salt, please do NOT edit[0;0m
                  [0;32m+search auto.dot[0;0m
                  [0;32m+nameserver 172.31.32.50[0;0m[0;0m
[0;36m----------[0;0m
    [0;36m      ID: sync_modules[0;0m
    [0;36mFunction: module.wait[0;0m
    [0;36m    Name: saltutil.sync_modules[0;0m
    [0;36m  Result: True[0;0m
    [0;36m Comment: Module function saltutil.sync_modules executed[0;0m
    [0;36m Started: 16:11:37.051080[0;0m
    [0;36mDuration: 179.705 ms[0;0m
[0;36m     Changes:   
              [0;36m----------[0;0m
              [0;36mret[0;0m:[0;0m
[0;36m----------[0;0m
    [0;36m      ID: reload_resolv_conf[0;0m
    [0;36mFunction: module.wait[0;0m
    [0;36m    Name: helper.reload_resolv_conf[0;0m
    [0;36m  Result: True[0;0m
    [0;36m Comment: Module function helper.reload_resolv_conf executed[0;0m
    [0;36m Started: 16:11:37.232042[0;0m
    [0;36mDuration: 1.738 ms[0;0m
[0;36m     Changes:   
              [0;36m----------[0;0m
              [0;36mret[0;0m:
                  [0;1;33mNone[0;0m[0;0m
[0;36m----------[0;0m
    [0;36m      ID: schedule_salt-minion_restart[0;0m
    [0;36mFunction: cmd.wait[0;0m
    [0;36m    Name: nohup /bin/sh -c 'sleep 3; salt-call --local service.stop salt-minion; sleep 3; killall salt-minion; sleep 3; salt-call --local service.restart salt-minion; sleep 3; salt-call --local service.start salt-minion' >>/var/log/salt/minion 2>&1 & echo Salt-Minion Restart Scheduled ...[0;0m
    [0;36m  Result: True[0;0m
    [0;36m Comment: Command "nohup /bin/sh -c 'sleep 3; salt-call --local service.stop salt-minion; sleep 3; killall salt-minion; sleep 3; salt-call --local service.restart salt-minion; sleep 3; salt-call --local service.start salt-minion' >>/var/log/salt/minion 2>&1 & echo Salt-Minion Restart Scheduled ..." run[0;0m
    [0;36m Started: 16:11:37.235327[0;0m
    [0;36mDuration: 13.73 ms[0;0m
[0;36m     Changes:   
              [0;36m----------[0;0m
              [0;36mpid[0;0m:
                  [0;1;33m4621[0;0m
              [0;36mretcode[0;0m:
                  [0;1;33m0[0;0m
              [0;36mstderr[0;0m:
              [0;36mstdout[0;0m:
                  [0;32mSalt-Minion Restart Scheduled ...[0;0m[0;0m
[0;32m----------[0;0m
    [0;32m      ID: /tmp/test[0;0m
    [0;32mFunction: file.managed[0;0m
    [0;32m  Result: True[0;0m
    [0;32m Comment: File /tmp/test is in the correct state[0;0m
    [0;32m Started: 16:11:37.249366[0;0m
    [0;32mDuration: 1.174 ms[0;0m
[0;32m     Changes:   [0;0m
[0;36m
Summary for minion
------------[0;0m
[0;32mSucceeded: 5[0;0m ([0;32mchanged=4[0;0m)
[0;36mFailed:    0[0;0m
[0;36m------------
Total states run:     5[0;0m
[0;0m# salt minion cmd.run 'cat /etc/resolv.conf'
[0;36mminion[0;0m:
    [0;32m; Managed by Salt, please do NOT edit[0;0m
    [0;32msearch auto.dot[0;0m
    [0;32mnameserver 172.31.32.50[0;0m
[0;0m# salt minion cmd.run 'nslookup ip-172-31-32-50.ec2.internal'
[0;36mminion[0;0m:
    [0;32mServer:		172.31.32.50[0;0m
    [0;32mAddress:	172.31.32.50#53[0;0m
    [0;32m[0;0m
    [0;32mNon-authoritative answer:[0;0m
    [0;32mName:	ip-172-31-32-50.ec2.internal[0;0m
    [0;32mAddress: 172.31.32.50[0;0m
[0;0m# salt minion cmd.run 'nslookup api.auto.dot'
[0;36mminion[0;0m:
    [0;32mServer:		172.31.32.50[0;0m
    [0;32mAddress:	172.31.32.50#53[0;0m
    [0;32m[0;0m
    [0;32mName:	api.auto.dot[0;0m
    [0;32mAddress: 172.31.32.50[0;0m
